---
title: "diffobj - Diffs for R Objects"
author: "Brodie Gaslam"
output:
    function(...) rmarkdown::html_vignette(..., md_extensions="-markdown_in_html_blocks"):
        toc: true
        css: styles.css

vignette: >
  %\VignetteIndexEntry{diffobj}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

## Introduction

`diffobj` uses the same comparison mechanism used by `git diff` and `diff` to highlight differences between R objects:

```{r, results="asis"}
library(diffobj)
set.seed(1)
a <- b <- matrix(sample(1:50), 10)
b[sample(1:50, 5)] <- sample(1:50, 5)
diffPrint(target=a, current=b)
```

`diffobj` comparisons work best when objects have some similarities, or when they are relatively small.  The package was originally developed to help diagnose failed unit tests by comparing test results to reference objects in a human-friendly manner.

## Function Overview

There are a variety of related functions for comparing objects:

* `diffPrint`: use the `print`/`show` output
* `diffStr`: use the output of `str`
* `diffObj`: pick between `print`/`show` and `str` depending on which provides the "best" overview of differences
* `diffChr`: use the contents of character vectors instead of their display representations
* `diffFile`: compare the text content of two files
* `diffCsv`: load two CSV files into data frames and compare the data frames with `diffPrint`
* `diffDeparse`: compare the deparsed objects
* `ses`: compute the element by element shortest edit script on two character vectors

Note the `diff*` functions use lowerCamelCase in keeping with S4 method name convention, whereas the package name itself is all lower case.

## Output

### Colored Diffs

`diffobj` produces colored diffs on your terminal if it supports ANSI escape sequences, or in your browser if it does not.  By default `diffobj` will output to HTML when run in `knitr`, as is the case here.

The default color schemes use yellow and blue to symbolize deletions and insertions for accessibility to dichromats.  If you prefer the more traditional color scheme you can specify `color.mode="rgb"` in the parameter list, or use `options(diffobj.color.mode="rgb")`.

### Structure

The first line of a diff (or two lines in `mode="unified"` or `mode="context"`) are meta data that provide contextual information for the diff:

```{r, results="asis"}
diffPrint(target=a, current=b, line.limit=2)
```

The very first line acts as a legend to the diff by associating the colors used to represent differences present in each object with the name of the object.  The symbols in the gutters provide additional cues useful when color is unavailable.  The second line is a hunk header and indicates what lines from the text representations of each of the objects are shown next.  Note these are not the lines you would get from subsetting the object directly; rather, they are those you would get from subsetting the `capture.output` result.

The result of the diff provides the information necessary to transform the
`target` object into the `current` object.  This involves deletions
from and additions to `target`.  The deletions and additions are done
linewise.  Each deleted line will have `< ` prepended to it, and each
added line will have `> ` prepended to it.

The output format used here is loosely based on the `git diff` format.

The first lines of output clarify the coding convention by showing the
`target` object with the deletion symbology, and the `current`
object with the addition symbology.  After these lines you will see the
first and possibly only hunk header.  The format will be `@@ x,y z,w @@`
where `x` and `z` indicate the starting line of the text in
the `target` and `current` objects that is shown after the hunk
header.  `y` and `w` indicate how many lines from each of those
objects are being shown.

In addition to the primary line diff, hunks are themselves word-diffed within
each hunk to help quickly identify small differences.  Just keep in mind that
the `+-` symbols always relate to the original line diff.  The
word-diff is indicated only by the ANSI escape sequence styling and will not
be visible if your terminal does not support them or if you disable them.




## Algorithm

The diff algorithm is Myer's solution to the shortest edit script /
longest common sequence problem with the Hirschberg linear space refinement
as described in:
> E. Myers, "An O(ND) Difference Algorithm and Its Variations",
Algorithmica 1, 2 (1986), 251-266.
\url{http://www.cs.arizona.edu/people/gene/PAPERS/diff.ps}

and should be the same algorithm used by GNU diff.  The implementation
used here is an adaptation of Michael B. Allen's diff program from the
[`libmba`](http://www.ioplex.com/~miallen/libmba/dl/libmba-0.9.1.tar.gz) `C` library.

This algorithm scales with the _square_ of the number of differences
between compared objects so is most effective when comparing objects
that are mostly similar.
